name: bitcoin
displayName: Bitcoin Knots
description: Full Bitcoin node with enhanced features and policy options
version: 29.2.knots20251110
category: bitcoin

source:
  type: binary
  githubRepo: bitcoinknots/bitcoin
  # Standard Knots download
  downloadUrl: "https://bitcoinknots.org/files/29.x/${version}/bitcoin-${version}-${arch}.tar.gz"
  checksumUrl: "https://bitcoinknots.org/files/29.x/${version}/SHA256SUMS"
  # BIP-110 variant from dathonohm/bitcoin
  bip110DownloadUrl: "https://github.com/dathonohm/bitcoin/releases/download/v${version}%2Bbip110-v0.1/bitcoin-${version}+bip110-v0.1-${arch}.tar.gz"
  bip110ChecksumUrl: "https://github.com/dathonohm/bitcoin/releases/download/v${version}%2Bbip110-v0.1/SHA256SUMS"

provides:
  - name: bitcoin-rpc
    port: 8332
    protocol: http
    credentials:
      type: rpc
      fields: [rpcuser, rpcpassword]
  - name: bitcoin-p2p
    port: 8333
    protocol: tcp
  - name: bitcoin-zmq-block
    port: 28332
    protocol: zmq
  - name: bitcoin-zmq-tx
    port: 28333
    protocol: zmq

tor:
  - name: bitcoin-p2p
    virtualPort: 8333
    targetPort: 8333
  - name: bitcoin-rpc
    virtualPort: 8332
    targetPort: 8332

configSchema:
  - name: variant
    type: select
    label: Bitcoin Knots Variant
    description: Standard Knots or with BIP-110 (temporary data restrictions)
    options: [standard, bip110]
    default: standard
  - name: network
    type: select
    label: Network
    description: Bitcoin network to connect to
    options: [mainnet, testnet, signet, regtest]
    default: mainnet
  - name: txindex
    type: boolean
    label: Transaction Index
    description: Enable full transaction index (required for Electrs)
    default: true
  - name: prune
    type: number
    label: Prune (MB)
    description: "Reduce disk usage by pruning old blocks. 0 = no pruning (full node)"
    default: 0
  - name: dbcache
    type: number
    label: DB Cache (MB)
    description: Database cache size in MB (higher = faster sync)
    default: 450
  - name: maxconnections
    type: number
    label: Max Connections
    description: Maximum number of peer connections
    default: 125
  - name: blocksonly
    type: boolean
    label: Blocks Only Mode
    description: Only download blocks, not unconfirmed transactions (saves bandwidth)
    default: false
  - name: assumevalid
    type: string
    label: Assume Valid Block
    description: Skip signature verification up to this block hash (leave empty for default)
    default: ""
  - name: rpcuser
    type: string
    label: RPC Username
    generated: true
    secret: true
  - name: rpcpassword
    type: password
    label: RPC Password
    generated: true
    secret: true

resources:
  minDisk: 700GB
  minMemory: 2GB
